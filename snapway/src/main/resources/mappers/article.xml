<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.snapway.model.mapper.ArticleMapper">

	<resultMap id="articleMap" type="Article">
		<id column="article_id" property="articleId"></id>
		<result column="title" property="title"></result>
		<result column="tags" property="tags"></result>
		<result column="author_id" property="authorId"></result>
		<result column="category" property="category"></result>
		<result column="content" property="content"></result>
		<result column="likes" property="likes"></result>
		<result column="hits" property="hits"></result>
		<result column="uploaded_at" property="uploadedAt"></result>
	</resultMap>

	<!-- 전체 게시판 조회 -->
	<select id="findAll" resultMap="articleMap">
		SELECT
			article_id,
			title,
			tags,
			author_id,
			category,
			content,
			likes,
			hits,
			uploaded_at
		FROM article
		ORDER BY article_id DESC;
	</select>

	<!-- 게시글 상세 조회 -->
	<select id="getArticle" parameterType="long" resultMap="articleMap">
		SELECT
			article_id,
			title,
			tags,
			author_id,
			category,
			content,
			likes,
			hits,
			uploaded_at
		FROM article
		WHERE article_id = #{articleId}
	</select>
	
	<!-- 게시글 등록 -->
	<insert id="saveArticle" parameterType="Article" 
		useGeneratedKeys="true" keyProperty="articleId" keyColumn="article_id">
		INSERT INTO article(
			title,
			tags,
			author_id,
			category,
			content,
			likes,
			hits,
			uploaded_at
		)
		VALUES(
			#{title},
			#{tags},
			#{authorId},
			#{category},
			#{content},
			#{likes},
			#{hits},
			NOW()
		)
		
	</insert>

	<!-- 게시글 수정 -->
	<update id="updateArticle" parameterType="Article">
		UPDATE article
		SET
			title = #{title},
			tags = #{tags},
			category = #{category},
			content = #{content}
		WHERE article_id = #{articleId}
	</update>

	<!-- 게시글 삭제 -->
	<delete id="deleteArticle" parameterType="long">
		DELETE FROM article
		WHERE article_id = #{articleId}
	</delete>

	<!-- 조회수 증가 -->
	<update id="increaseHits" parameterType="long">
		UPDATE article
		SET hits = hits + 1
		WHERE article_id = #{articleId}
	</update>
</mapper>
